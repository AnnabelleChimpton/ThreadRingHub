  FROM node:24-slim AS development

  # Install system dependencies
  RUN apt-get update && apt-get install -y \
      curl \
      openssl \
      && rm -rf /var/lib/apt/lists/*

  # Set working directory
  WORKDIR /app

  # Copy root configuration files
  COPY package*.json ./
  COPY tsconfig.json ./
  COPY turbo.json ./

  # Create apps directory structure
  RUN mkdir -p apps/hub-api

  # Copy hub-api package.json
  COPY apps/hub-api/package.json ./apps/hub-api/

  # Install dependencies
  RUN npm ci

  # Copy source code
  COPY apps/hub-api/ ./apps/hub-api/
  COPY infra/ ./infra/

  # Set working directory to hub-api
  WORKDIR /app/apps/hub-api

  # Generate Prisma client
  RUN npx prisma generate

  # Expose port
  EXPOSE 3000
  EXPOSE 9229

  # Health check
  HEALTHCHECK --interval=30s --timeout=10s --start-period=5s --retries=3 \
    CMD curl -f http://localhost:3000/health || exit 1

  # Start the development server
  CMD ["npm", "run", "dev"]